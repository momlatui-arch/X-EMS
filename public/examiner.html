<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<title>FTO ‚Äì Dashboard</title>
<style>
body {
    font-family: Arial, sans-serif;
    background: #f1f5f9;
    padding: 20px;
}
h1 { margin-bottom: 10px; }
button {
    padding: 10px 20px;
    font-size: 16px;
    background: #2563eb;
    color: #fff;
    border: none;
    cursor: pointer;
    margin-bottom: 20px;
}
button:disabled {
    background: #94a3b8;
    cursor: not-allowed;
}
table {
    border-collapse: collapse;
    width: 100%;
    background: #fff;
    margin-bottom: 30px;
}
th, td {
    border: 1px solid #cbd5e1;
    padding: 8px;
    text-align: left;
    font-size: 14px;
}
th { background: #e2e8f0; }
.success { color: green; font-weight: bold; }
.danger { color: red; font-weight: bold; }
</style>
</head>
<body>

<h1>üë®‚Äç‚öñÔ∏è DASHBOARD GI√ÅM KH·∫¢O</h1>

<button id="startBtn" onclick="startExam()">üöÄ B·∫ÆT ƒê·∫¶U K·ª≤ THI</button>

<h2>üìã K·∫øt qu·∫£ th√≠ sinh</h2>
<table id="results"></table>

<h2>üö® Log gian l·∫≠n</h2>
<table id="logs"></table>

<script>
const API_BASE = location.origin;
const resultsTable = document.getElementById("results");
const logsTable = document.getElementById("logs");
const startBtn = document.getElementById("startBtn");

/* ================= LOAD DASHBOARD ================= */
async function load() {
    try {
        const res = await fetch(API_BASE + "/api/dashboard");
        if (!res.ok) throw new Error("HTTP " + res.status);

        const data = await res.json();

        const results = Array.isArray(data.results) ? data.results : [];
        const logs = Array.isArray(data.logs) ? data.logs : [];

        if (data.examStarted) {
            startBtn.disabled = true;
            startBtn.innerText = "‚è≥ K·ª≥ thi ƒëang di·ªÖn ra";
        }

        resultsTable.innerHTML = `
            <tr>
                <th>H·ªç t√™n</th>
                <th>ƒêi·ªÉm</th>
                <th>K·∫øt qu·∫£</th>
                <th>Th·ªùi gian</th>
            </tr>
        ` + results.map(r => `
            <tr>
                <td>${r.name}</td>
                <td>${r.score}/10</td>
                <td class="${r.result === "ƒê·∫¨U" ? "success" : "danger"}">
                    ${r.result}
                </td>
                <td>${r.time}</td>
            </tr>
        `).join("");

        logsTable.innerHTML = `
            <tr>
                <th>H·ªç t√™n</th>
                <th>Lo·∫°i</th>
                <th>L√Ω do</th>
                <th>Th·ªùi gian</th>
            </tr>
        ` + logs.map(l => `
            <tr>
                <td>${l.name}</td>
                <td class="danger">${l.type}</td>
                <td>${l.reason || ""}</td>
                <td>${l.time}</td>
            </tr>
        `).join("");

    } catch (err) {
        console.warn("‚ö†Ô∏è Kh√¥ng k·∫øt n·ªëi ƒë∆∞·ª£c server", err.message);
    }
}


/* ================= START EXAM ================= */
async function startExam() {
    if (!confirm("B·∫°n ch·∫Øc ch·∫Øn mu·ªën B·∫ÆT ƒê·∫¶U k·ª≥ thi?")) return;

    await fetch(API_BASE + "/api/exam/start", { method: "POST" });
    startBtn.disabled = true;
    startBtn.innerText = "‚è≥ K·ª≥ thi ƒëang di·ªÖn ra";
}

/* ================= AUTO REFRESH ================= */
load();
setInterval(load, 2000);
</script>

</body>
</html>
